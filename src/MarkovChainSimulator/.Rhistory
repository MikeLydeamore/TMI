labs(x="Age [months]", y="S(t)") +
scale_x_continuous(limits = c(0, 60), expand=c(0,0)) + scale_y_continuous(limits = c(0, 1), expand=c(0,0)) +
theme(panel.grid = element_blank())
ggsave(paste(graphicsPathName, "scabies_all_models.png", sep=""), width = 13.58, height = 6, units = "cm", type = "cairo-png")
ggsave(paste(graphicsPathName, "scabies_all_models.png", sep=""), width = 13.58, height = 6.1, units = "cm", type = "cairo-png")
CPH
CPH_scabies_communities <- CPH
fitCPH <- coxph(Surv(time, status)~birth_quarter, data=df_scabies_filtered)
covariates <- data.frame("birth_quarter"=c(1, 2, 3, 4))
CPH <- survfit(fitCPH, newdata=covariates)
covariates <- data.frame("birth_quarter"=as.factor(c(1, 2, 3, 4)))
CPH <- survfit(fitCPH, newdata=covariates)
CPH_scabies_birthquarters <- CPH
CPH_scabies_birthquarters
CPH_scabies_communities
0.405*12
(0.720-0.405)*12
library(pryr)
library(plyr)
library(dplyr)
library(ggplot2)
source('~/Documents/PhD/GAS/2016_East_Arnhem_Healthy_Skin/clinic/scripts/regressionTesting.R')
library(Cairo)
saveGraphics <- F
#Skin sores
graphicsPathName <- "/Users/mlydeamore/Documents/PhD/GAS/2016_East_Arnhem_Healthy_Skin/clinic/scripts/regression/"
#Data loading
df_skinsores <- loadGASData()
df_skinsores_filtered <- filter(df_skinsores, birth_year != 2006)
#Cox - All covariates
fullCPH <- coxph(Surv(time, status)~community+sex+birth_year+birth_quarter, data=df_skinsores_filtered)
#COX - Just Community
fitCPH <- coxph(Surv(time, status)~community_B+community_C+community_D+community_E, data=df_skinsores_filtered)
covariates <- data.frame(rbind(rep(0,4), diag(4)))
colnames(covariates) <- c("community_B","community_C","community_D","community_E")
CPH <- survfit(fitCPH, newdata = covariates)
ggframe <- data.frame(time = CPH$time, surv = CPH$surv)
colnames(ggframe) <- c("Time","A","B","C", "D", "E")
CoxFrame <- reshape2:::melt.data.frame(data=ggframe, id.vars = "Time", variable.name = "Community", value.name="S")
#Parametric
listMLE <- lapply(levels(df_skinsores_filtered$community), function(x) {fitParametricBy(df_skinsores_filtered, x)})
MLETime <- seq(0, 6, 0.02)
l <- lapply(1:5, function(x) { convertMLEToFrame(MLETime, listMLE[[x]], levels(df_skinsores_filtered$community)[x])})
MLEFrame <- rbind.fill(l)
#Bootstrapping for CI:
estimatesLambda <- lapply(1:5, function(x) {
bootstr <- bootstrap(listMLE[[x]]$alpha, listMLE[[x]]$lambda, df = filter(df_skinsores_filtered, community == levels(df_skinsores_filtered$community)[x]), n = 200)
estimatesAlpha <- sapply(X = bootstr["estimate", ], FUN=head, 1)
estimatesLambda <- sapply(X = bootstr["estimate",], FUN=tail, 1)
medians <- -log((0.5-estimatesAlpha)/(1-estimatesAlpha)) /estimatesLambda
return (data.frame(community = levels(df_skinsores_filtered$community)[x],
lower = quantile(medians, probs = 0.05), upper = quantile(medians, probs = 0.95),
lowerAlpha = quantile(estimatesAlpha, probs=0.05), upperAlpha = quantile(estimatesAlpha, probs=0.95),
lowerMean = quantile(1/estimatesLambda, probs=0.05), upperMean = quantile(1/estimatesLambda, probs=0.95)))})
#Kaplan-Meier
KMSkinsores <- lapply(levels(df_skinsores_filtered$community), fitKMByCommunity, df=df_skinsores_filtered)
KMList <- lapply(1:5, function(x) { ret <- data.frame(Time=KMSkinsores[[x]]$time, surv=KMSkinsores[[x]]$surv, upper=KMSkinsores[[x]]$upper, lower=KMSkinsores[[x]]$lower,
Community = rep(levels(df_skinsores_filtered$community)[x], length(KMSkinsores[[x]]$time)) )} )
KMFrame <- rbind.fill(KMList)
#Residuals
residualParametric <- sapply(seq(1, nrow(KMFrame)), function(x) { calculateParametricEstimateAtTime(KMFrame[x, "Time"], listMLE[[KMFrame[x, "Community"] ]] ) - KMFrame[x, "surv"] } )
KMFrame$residualParametric <- residualParametric
#Boxplot of medians
comms <- levels(df_skinsores_filtered$community)
KMMedian <- lapply(1:5, function(x) { unname(summary(KMSkinsores[[x]])$table["median"])}) %>% unlist(.)
KMLower <- lapply(1:5, function(x) { unname(summary(KMSkinsores[[x]])$table["0.95LCL"])}) %>% unlist(.)
KMUpper <- lapply(1:5, function(x) { unname(summary(KMSkinsores[[x]])$table["0.95UCL"])}) %>% unlist(.)
KMMedianFrame <- data.frame(community = comms, model = rep("KM", length(comms)), median = KMMedian, lower = KMLower, upper=KMUpper)
KMMedianFrame[is.na(KMMedianFrame$upper), "upper"] <- KMMedianFrame[is.na(KMMedianFrame$upper), "median"]
CoxMedian <- summary(CPH)$table[,"median"]
CoxLower <- summary(CPH)$table[,"0.95LCL"]
CoxUpper <- summary(CPH)$table[,"0.95UCL"]
CoxMedianFrame <- data.frame(community = comms, model = rep("Cox", length(comms)), median = CoxMedian, lower = CoxLower, upper=CoxUpper)
ParametricMedian <- lapply(1:5, function(x) { (-log((0.5-listMLE[[x]]$alpha)/(1-listMLE[[x]]$alpha)))/listMLE[[x]]$lambda }) %>% unlist(.)
ParametricLower <- rbind.fill(estimatesLambda)$lower
ParametricUpper <- rbind.fill(estimatesLambda)$upper
ParametricMedianFrame <- data.frame(community = comms, model = rep("Parametric", length(comms)), median=ParametricMedian, lower=ParametricLower, upper=ParametricUpper)
medianFrame <- rbind.fill(KMMedianFrame, CoxMedianFrame, ParametricMedianFrame)
### Plotting ###
# Cox, Kaplan-Meier and Parametric, stratified by community, no CI.
ggplot() + geom_line(data = KMFrame, mapping = aes(x=Time*12, y=surv, colour=Community, linetype="Kaplan-Meier")) +
geom_line(data = MLEFrame, aes(x=time*12, y=estimate, colour=Community, linetype="Parametric")) + facet_wrap("Community") +
geom_line(data = CoxFrame, aes(x=Time*12, y=S, colour=Community, linetype="Cox")) +
scale_linetype_manual(values = c("Kaplan-Meier"="solid", "Cox"="dashed", "Parametric"="dotted")) + theme_bw() + theme(legend.title = element_blank(), legend.position = c(0.92,0.15), legend.justification = c(1,0), text = element_text(size = 7)) +
labs(x="Age [months]", y="S(t)") + guides(colour = F) + theme(panel.grid = element_blank()) +
scale_x_continuous(limits = c(0, 60), expand=c(0,0)) + scale_y_continuous(limits = c(0, 1), expand=c(0,0))
if (saveGraphics) {
ggsave(paste(graphicsPathName, "gas_all_models.png", sep=""), width = 13.58, height = 8.75, units = "cm")
}
# All Kaplan-Meier estimates, stratified by community, with CI.
ggplot() + geom_line(data = KMFrame, aes(x=Time, y=surv, colour=Community)) + geom_ribbon(data = KMFrame, aes(x=Time, ymin=lower, ymax=upper, fill=Community), alpha = 0.3) +
facet_wrap("Community") + theme_bw() + labs(x = "Age [years]", y = "S(t)") + theme(legend.position="none", text = element_text(size = 7)) +
scale_x_continuous(limits = c(0, 6), expand=c(0,0)) + scale_y_continuous(limits = c(0, 1), expand=c(0,0)) + theme(panel.grid = element_blank())
if (saveGraphics) {
ggsave(paste(graphicsPathName, "gas_kaplan_meier.png", sep=""), width = 13.58, height = 8.75, units = "cm", type = "cairo-png")
}
# Residuals between Parametric and Kaplan-Meier model - postive indicates Parametric > Kaplan-Meier, so a higher survival probability.
ggplot() + geom_point(data = KMFrame, aes(x=Time, y=residualParametric, colour=Community)) + geom_hline(yintercept=0) +
facet_wrap("Community") + theme_bw() + labs(x = "Age [years]", y = "Residuals") + theme(legend.position="none", text = element_text(size = 7)) +
scale_x_continuous(limits = c(0, 6), expand=c(0,0))
if (saveGraphics) {
ggsave(paste(graphicsPathName, "gas_residuals.png", sep=""), width = 13.58, height = 8.75, units = "cm", type = "cairo-png")
}
# Histogram of ages of first infection.
ggplot(data = filter(df_skinsores_filtered, status == 1)) + geom_histogram(aes(x=time*12), bins=60, colour="black") + theme_bw() + labs(x="Age [months]", y="Frequency") +
theme(text = element_text(size=12)) + scale_x_continuous(limits = c(0, 60), expand=c(0,0)) + scale_y_continuous(limits = c(0, NA), expand=c(0,0)) + expand_limits(y=60) +
theme(panel.grid = element_blank())
if (saveGraphics) {
ggsave(paste(graphicsPathName, "gas_ages_inection_histogram.png", sep=""), width = 13.58, height = 8.75, units="cm", type = "cairo-png")
}
#Bar chart of medians.
ggplot(data = medianFrame) + geom_boxplot(aes(x=model, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=model), stat = "identity") + facet_grid(.~community) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), legend.title = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
if (saveGraphics) {
ggsave(paste(graphicsPathName, "gas_median_comparisons.png", sep=""), width = 13.58, height = 8.75, units="cm", type = "cairo-png")
}
ggplot(data = medianFrame) + geom_boxplot(aes(x=community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=community), stat = "identity") + facet_grid(.~model) +
theme_bw() + labs(x="Community", y="Median Age [months]", fill="Community") + theme(text = element_text(size=7), axis.text.x= element_blank()) + theme(panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
colnames(KMFrame) <- c("Time", "S", "upper", "lower", "Community", "residualParametric")
colnames(MLEFrame) <- c("Time", "S", "Community")
KMFrame$Model <- rep("Kaplan-Meier", nrow(KMFrame))
MLEFrame$Model <- rep("Parametric", nrow(MLEFrame))
CoxFrame$Model <- rep("Cox", nrow(CoxFrame))
survframe <- rbind.fill(KMFrame, MLEFrame, CoxFrame)
ggplot(data = survframe) + geom_line(aes(x=Time*12, y=S, colour=Community)) + facet_grid(.~Model) +
theme_bw() + theme(text = element_text(size = 7)) +
labs(x="Age [months]", y="S(t)") +
scale_x_continuous(limits = c(0, 60), expand=c(0,0)) + scale_y_continuous(limits = c(0, 1), expand=c(0,0)) +
theme(panel.grid = element_blank())
head(medianFrame)
?gsub
medianFrame$model <- gsub("KM","Kaplan-Meier", medianFrame$model)
head(medianFrame)
ggplot(data = medianFrame) + geom_boxplot(aes(x=model, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=model), stat = "identity") + facet_grid(.~community) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), legend.title = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
colnames(medianFrame) <- c("Community","Model","median","lower","upper")
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), legend.title = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
medianFrame$Model <- as.factor(medianFrame$Model)
medianFrame$Model <- relevel(medianFrame$Model, "Cox")
medianFrame$Model <- relevel(medianFrame$Model, "Parametric")
medianFrame$Model <- relevel(medianFrame$Model, "Kaplan-Meier")
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 18))
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
()
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
r
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank())
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + coord_cartesian(ylim=c(0, 12))
ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Model", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), panel.grid = element_blank()) + coord_cartesian(ylim=c(0, 11.5))
presentation_theme <- theme(
panel.background = element_rect(fill = "transparent",colour = NA),
panel.border = element_rect(colour="white", size=2),
strip.background = element_rect(fill="#3C557F"),
strip.text = element_text(colour="white"),
plot.background = element_rect(fill = "transparent",colour = NA),
panel.grid = element_blank(),
text=element_text(colour="white",size=30,face="bold"),
axis.line=element_line(colour="white",size=3),
axis.ticks=element_line(colour="white",size=3),
axis.text = element_text(colour="white",size=20),
legend.title = element_text(size=22,margin=(b=2)),
legend.background = element_rect(colour="white",fill="transparent"),
legend.key.size=unit(15,"mm"),
legend.key = element_rect(fill="transparent",colour="transparent")#,
#legend.text = element_text(size=20)
)
p <- ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~model) +
theme_bw() + labs(x="Community", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), legend.title = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 11.5)) + presentation_theme
png("skinsores-medians-transparent.png", width=1280, height=600,units="px",bg = "transparent")
print(p)
dev.off()
p <- ggplot(data = medianFrame) + geom_boxplot(aes(x=Community, lower=lower*12, upper=upper*12, middle=median*12, ymax = upper*12, ymin = lower*12, fill=Community), stat = "identity") + facet_grid(.~Model) +
theme_bw() + labs(x="Community", y="Median Age [months]") +
theme(text = element_text(size=7), axis.text.x = element_blank(), legend.title = element_blank(), panel.grid = element_blank()) + #+ scale_fill_grey(start = 0.35, name="Model")
coord_cartesian(ylim=c(0, 11.5)) + presentation_theme
png("skinsores-medians-transparent.png", width=1280, height=600,units="px",bg = "transparent")
print(p)
dev.off()
setwd()
getwd()
?diff
x <- c(1, 2, 4, 3, 5)
diff(x)
install.packages("EasyABC")
library(EasyABC)
install.packages("ggplot2")
?ABC_sequential
?ABC_mcmc
?ABC_sequential
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep="",))
return (df)
})
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep=""))
return (df)
})
head(df)
library(ggplot2)
?groupping
?grouping
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep=""))
df$sim_number <- x
return (df)
})
head(df)
melt(df[[1]], id.vars="t")
library(reshape2)
melt(df[[1]], id.vars="t")
melt(df[[1]], id.vars=c("t", "sim_number"))
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep=""))
df$sim_number <- x
df <- melt(df, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbind.fill(df)
?rbind_list
library(pryr)
rbindlist
library(data.table)
install.packages("data.table")
library(data.table)
rbindlist
df <- rbindlist(df)
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number)) + facet_grid(.~variable)
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.4) + facet_grid(.~variable)
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.4, colour="gray") + facet_grid(.~variable)
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable)
df$variable <- factor(df$variable, levels=c("S","I","R"))
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable)
ggplot(df) + geom_line(aes(x=t, y=value/1000, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable)
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep=""))
df$sim_number <- x
df <- melt(df, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","R"))
ggplot(df) + geom_line(aes(x=t, y=value/1000, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable)
library(cowplot)
install.packages("cowplot)")
install.packages("cowplot")
library(cowplot)
ggplot(df) + geom_line(aes(x=t, y=value/1000, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable)
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
df_deterministic <- melt(df_deterministic, id.vars="t")
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","R"))
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
max(df$t)
df_deterministic$t < max(df$t)
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
df_deterministic$t < max(df$t)
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","R"))
ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
ggsave("/Users/mlydeamore/cloudstor/JCompSimPaper/SIRModel", scale = 0.5, type="cairo-png")
library(Cairo)
install.packages("Cairo")
library(Cairo)
ggsave("/Users/mlydeamore/cloudstor/JCompSimPaper/SIRModel", scale = 0.5, type="cairo-png")
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/SIROutput.png", p)
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/SIROutput.png", p, base_aspect_ratio = 0.3)
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/SIROutput.png", p, base_aspect_ratio = 3.1)
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/SIROutput.png", p, base_aspect_ratio = 2.6)
library(EasyABC)
?ABC_sequential
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df$sim_number <- x
df2 <- data.frame("S"=df$S+df$S2, "I"=df$I+df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","E"))
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df$sim_number <- x
df2 <- data.frame("S"=df$S+df$S2, "I"=df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","E"))
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df2 <- data.frame("S"=df$S+df$S2, "I"=df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2$sim_number <- x
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","E"))
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df2 <- data.frame("t"=df$t, "S"=df$S+df$S2, "I"=df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2$sim_number <- x
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","E"))
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
?with
with(df_deterministic, df_deterministic <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
head(df_deterministic)
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
with(df_deterministic, df_deterministic <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","R"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
p
head(df_deterministic)
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
with(df_deterministic, df_deterministic <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
head(df_deterministic)
with(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
with(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
head(df2)
within(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df2 <- within(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
head(df2)
with(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
rm(list="df2")
head(df2)
with(df_deterministic, df2 <- data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
head(df2)
df2 <- with(df_deterministic, data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
head(df2)
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","R"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
p
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
df2 <- with(df_deterministic, data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","E"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
p
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
df_deterministic <- with(df_deterministic, data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","E"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
p
head(df_deterministic)
head(df)
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df2 <- data.frame("t"=df$t, "S"=df$S+df$S2, "I"=df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2$sim_number <- x
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df)
})
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/Scabies/run-", x, ".csv", sep=""))
df2 <- data.frame("t"=df$t, "S"=df$S+df$S2, "I"=df$IA+df$IAHat+df$IHat+df$I2C+df$I2CHat+df$I2+df$I2Hat, "E"=df$GHat+df$YHat+df$I2CHat+df$I2Hat+df$IHat)
df2$sim_number <- x
df2 <- melt(df2, id.vars=c("t", "sim_number"))
return (df2)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","E"))
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/ScabiesDeterministic.csv")
df_deterministic <- with(df_deterministic, data.frame("t"=t, "S"=S+S2, "I"=IA+IAHat+IHat+I2C+I2CHat+I2+I2Hat, "E"=GHat+YHat+I2CHat+I2Hat+IHat))
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","E"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value))
p
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/ScabiesOutput.png", p, base_aspect_ratio = 2.6)
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value)) + labs("y"="Number of Individuals", "x"="Time")
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/ScabiesOutput.png", p, base_aspect_ratio = 2.6)
df <- lapply(1:500, function(x) {
df <- read.csv(paste("~/Documents/PhD/MarkovChainSimulator/outputs/SIR/run-", x, ".csv", sep=""))
df$sim_number <- x
df <- melt(df, id.vars=c("t", "sim_number"))
return (df)
})
df <- rbindlist(df)
df$variable <- factor(df$variable, levels=c("S","I","R"))
df_deterministic <- read.csv("~/Documents/PhD/MarkovChainSimulator/SIRDeterministic.csv")
df_deterministic <- df_deterministic[df_deterministic$t < max(df$t), ]
df_deterministic <- melt(df_deterministic, id.vars="t")
df_deterministic$variable <- factor(df_deterministic$variable, levels=c("S","I","R"))
p <- ggplot(df) + geom_line(aes(x=t, y=value, group=sim_number), alpha = 0.2, colour="gray") + facet_grid(.~variable) +
geom_line(data = df_deterministic, aes(x=t, y=value)) + labs("y"="Number of Individuals", "x"="Time")
save_plot("/Users/mlydeamore/cloudstor/JCompSimPaper/SIROutput.png", p, base_aspect_ratio = 2.6)
library(pryr)
install.packages("pyryr")
install.packages(pryr)
install.packages("pryr")
library(plyr)
library(dplyr)
install.packages("dplyr")
library(dplyr)
library(ggplot2)
source('~/Documents/PhD/GAS/2016_East_Arnhem_Healthy_Skin/clinic/scripts/regressionTesting.R')
library(Cairo)
graphicsPathName <- "/Users/mlydeamore/Documents/PhD/GAS/2016_East_Arnhem_Healthy_Skin/clinic/scripts/regression/"
saveGraphics <- F
df_scabies <- loadScabiesData()
df_scabies_filtered <- filter(df_scabies, birth_year != 2006)
fitCPH <- coxph(Surv(time, status)~community_B+community_C+community_D+community_E, data=df_scabies_filtered)
cox.zph(fitCPH)
setwd("~/Documents/PhD")
setwd("~/Documents/PhD/MarkovChainSimulator/")
df <- read.csv("outputs/Chickens/run-1.csv")
average <- data.frame("Ch"=df[nrow(df), "Ch.S"], "eG"=df[nrow(df), "eG.S"], "lG"=df[nrow(df), "lG.S"], "He"=df[nrow(df), "He.S"], "Rs"=df[nrow(df), "Rs.S"])
for (i in seq(2, 50)) {
df <- read.csv(paste("outputs/Chickens/run-",i,".csv", sep=""))
average$Ch = average$Ch + df[nrow(df), "Ch.S"]
average$eG = average$eG + df[nrow(df), "eG.S"]
average$lG = average$lG + df[nrow(df), "lG.S"]
average$He = average$He + df[nrow(df), "He.S"]
average$Rs = average$Rs + df[nrow(df), "Rs.S"]
}
average <- average/50
age_prop <- average/sum(average)
end_size <- 0
died_out <- 0
average_frame <- read.csv("outputs/Chickens/run-1.csv")
average_frame[, -1] <- average_frame[, -1]/100
for (i in seq(2, 100)) {
df <- read.csv(paste("outputs/Chickens/run-",i,".csv", sep=""))
temp <- df
while (temp[nrow(temp), 1] > 1000.1) {
temp <- temp[-nrow(temp), ]
}
temp[, -1] <- temp[, -1]/100
average_frame[, -1] <- average_frame[, -1] + temp[, -1]
}
ggplotMatrixLinesOnly <- function (df, id.vars, ...)
{
foo <- melt(df, id.vars)
geom_line(data = foo, aes_string(x = id.vars, y = "value",
colour = "variable"), ...)
}
p <- ggplot()
library(ggplot2)
p <- ggplot()
for (i in seq(1, 100)) {
df <- read.csv(paste("outputs/Chickens/run-",i,".csv", sep=""))
p <- p + ggplotMatrixLinesOnly(df, id.vars="t", alpha=0.2)
}
library(reshape2)
for (i in seq(1, 100)) {
df <- read.csv(paste("outputs/Chickens/run-",i,".csv", sep=""))
p <- p + ggplotMatrixLinesOnly(df, id.vars="t", alpha=0.2)
}
p
head(df)
sum(df[1, -1])
tail(df)
library(devtoosl)
library(devtools)
install.packages("devtools")
